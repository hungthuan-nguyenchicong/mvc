# h1

Để hiểu rõ hơn về PHP MVC code thuần và Vanilla JS SPA code thuần cho admin dashboard, bạn nên bắt đầu với mô hình HMVC (Hierarchical Model-View-Controller) hoặc Modular MVC. Mô hình này sẽ giúp bạn tổ chức code một cách rõ ràng và dễ quản lý, đặc biệt khi làm việc với nhiều tính năng khác nhau trong một admin dashboard.

PHP MVC Code Thuần (Backend: Controller -> JSON)
Khi làm PHP MVC code thuần, bạn sẽ tự xây dựng các thành phần của MVC mà không phụ thuộc vào một framework có sẵn. Điều này giúp bạn hiểu sâu sắc về cách hoạt động của từng phần.

Cấu trúc thư mục cơ bản (theo hướng HMVC/Modular)
/public             // Nơi chứa file index.php (điểm vào duy nhất) và tài nguyên tĩnh
    /css
    /js
    .htaccess       // Rewrite URL

/app
    /Core           // Các lớp lõi của ứng dụng (Router, Request, Response, Database, etc.)
        Router.php
        Request.php
        Response.php
        Database.php
        Controller.php // Lớp Controller cơ sở
    /Models         // Các lớp Model
        UserModel.php
        ProductModel.php
    /Modules        // Các Module (ví dụ cho HMVC)
        /Users
            UserController.php
            User.php        // Model cụ thể cho module
            /views          // Views (nếu có, thường là HTML cho backend truyền thống, nhưng ở đây sẽ là JSON)
                // (Không dùng cho JSON API)
        /Products
            ProductController.php
            Product.php     // Model cụ thể cho module
    /config         // Các file cấu hình
        database.php
        app.php
    init.php        // File khởi tạo ứng dụng
Các thành phần chính
public/.htaccess: Để định tuyến mọi request về index.php.

Apache

RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php/$1 [L]
public/index.php: Điểm vào duy nhất của ứng dụng.

PHP

<?php
require_once __DIR__ . '/../app/init.php';

use App\Core\Router;
use App\Core\Request;
use App\Core\Response;

$router = new Router();
$request = new Request();
$response = new Response();

// Định nghĩa các Routes API
$router->get('/api/users', 'Users@index');
$router->get('/api/users/{id}', 'Users@show');
$router->post('/api/users', 'Users@store');
$router->put('/api/users/{id}', 'Users@update');
$router->delete('/api/users/{id}', 'Users@destroy');

$router->get('/api/products', 'Products@index');
// ... thêm các route khác

$router->dispatch($request, $response);
app/init.php: Khởi tạo autoloader và các cài đặt ban đầu.

PHP

<?php
// Autoloader đơn giản
spl_autoload_register(function ($class) {
    $file = __DIR__ . '/' . str_replace('\\', '/', $class) . '.php';
    if (file_exists($file)) {
        require_once $file;
    }
});

// Load cấu hình (ví dụ: database)
require_once __DIR__ . '/config/database.php';

// Kết nối CSDL
use App\Core\Database;
Database::getInstance(DB_HOST, DB_NAME, DB_USER, DB_PASS);
app/Core/Router.php: Xử lý định tuyến URL đến Controller và Action tương ứng.

PHP

<?php
namespace App\Core;

class Router
{
    protected $routes = [];

    public function addRoute($method, $path, $callback)
    {
        $this->routes[] = ['method' => $method, 'path' => $path, 'callback' => $callback];
    }

    public function get($path, $callback) { $this->addRoute('GET', $path, $callback); }
    public function post($path, $callback) { $this->addRoute('POST', $path, $callback); }
    public function put($path, $callback) { $this->addRoute('PUT', $path, $callback); }
    public function delete($path, $callback) { $this->addRoute('DELETE', $path, $callback); }

    public function dispatch(Request $request, Response $response)
    {
        $uri = $request->getUri();
        $method = $request->getMethod();

        foreach ($this->routes as $route) {
            // Biến đổi route path thành regex để bắt tham số
            $pattern = preg_replace('/\{([a-zA-Z0-9_]+)\}/', '([a-zA-Z0-9_]+)', $route['path']);
            $pattern = '#^' . $pattern . '$#';

            if ($route['method'] === $method && preg_match($pattern, $uri, $matches)) {
                array_shift($matches); // Loại bỏ phần tử đầu tiên (full match)

                list($controllerName, $actionName) = explode('@', $route['callback']);
                $controllerFile = __DIR__ . '/../Modules/' . $controllerName . '/' . $controllerName . 'Controller.php';
                $controllerClass = 'App\\Modules\\' . $controllerName . '\\' . $controllerName . 'Controller';

                if (file_exists($controllerFile)) {
                    require_once $controllerFile;
                    $controller = new $controllerClass();

                    if (method_exists($controller, $actionName)) {
                        call_user_func_array([$controller, $actionName], $matches);
                        return;
                    }
                }
            }
        }

        $response->json(['message' => 'Not Found'], 404);
    }
}
app/Core/Request.php: Xử lý các thông tin từ request HTTP.

PHP

<?php
namespace App\Core;

class Request
{
    public function getUri()
    {
        return parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);
    }

    public function getMethod()
    {
        return $_SERVER['REQUEST_METHOD'];
    }

    public function getBody()
    {
        if ($this->getMethod() === 'POST' || $this->getMethod() === 'PUT') {
            $contentType = $_SERVER['CONTENT_TYPE'] ?? '';
            if (strpos($contentType, 'application/json') !== false) {
                return json_decode(file_get_contents('php://input'), true);
            }
            return $_POST;
        }
        return [];
    }

    public function query($key = null)
    {
        if ($key) {
            return $_GET[$key] ?? null;
        }
        return $_GET;
    }
}
app/Core/Response.php: Xử lý việc trả về response (ở đây là JSON).

PHP

<?php
namespace App\Core;

class Response
{
    public function json($data, $statusCode = 200)
    {
        header('Content-Type: application/json');
        http_response_code($statusCode);
        echo json_encode($data);
        exit();
    }
}
app/Core/Database.php: Lớp kết nối cơ sở dữ liệu (sử dụng PDO).

PHP

<?php
namespace App\Core;

use PDO;
use PDOException;

class Database
{
    private static $instance = null;
    private $connection;

    private function __construct($host, $db_name, $username, $password)
    {
        try {
            $this->connection = new PDO("mysql:host=$host;dbname=$db_name", $username, $password);
            $this->connection->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        } catch (PDOException $e) {
            die("Database connection failed: " . $e->getMessage());
        }
    }

    public static function getInstance($host, $db_name, $username, $password)
    {
        if (!self::$instance) {
            self::$instance = new Database($host, $db_name, $username, $password);
        }
        return self::$instance;
    }

    public function getConnection()
    {
        return $this->connection;
    }
}
app/Core/Controller.php: Lớp Controller cơ sở (các controller khác sẽ kế thừa).

PHP

<?php
namespace App\Core;

class Controller
{
    protected $request;
    protected $response;

    public function __construct()
    {
        $this->request = new Request();
        $this->response = new Response();
    }

    // Helper để trả về JSON
    protected function json($data, $statusCode = 200)
    {
        $this->response->json($data, $statusCode);
    }
}
app/Modules/Users/UserController.php: Ví dụ Controller cho Module Users.

PHP

<?php
namespace App\Modules\Users;

use App\Core\Controller;
use App\Modules\Users\User; // Model cho User

class UserController extends Controller
{
    private $userModel;

    public function __construct()
    {
        parent::__construct();
        $this->userModel = new User();
    }

    public function index()
    {
        $users = $this->userModel->getAllUsers();
        $this->json($users);
    }

    public function show($id)
    {
        $user = $this->userModel->getUserById($id);
        if ($user) {
            $this->json($user);
        } else {
            $this->json(['message' => 'User not found'], 404);
        }
    }

    public function store()
    {
        $data = $this->request->getBody();
        if ($this->userModel->createUser($data)) {
            $this->json(['message' => 'User created successfully', 'data' => $data], 201);
        } else {
            $this->json(['message' => 'Failed to create user'], 500);
        }
    }

    public function update($id)
    {
        $data = $this->request->getBody();
        if ($this->userModel->updateUser($id, $data)) {
            $this->json(['message' => 'User updated successfully'], 200);
        } else {
            $this->json(['message' => 'Failed to update user or user not found'], 500);
        }
    }

    public function destroy($id)
    {
        if ($this->userModel->deleteUser($id)) {
            $this->json(['message' => 'User deleted successfully'], 200);
        } else {
            $this->json(['message' => 'Failed to delete user or user not found'], 500);
        }
    }
}
app/Modules/Users/User.php: Ví dụ Model cho User (tương tác với DB).

PHP

<?php
namespace App\Modules\Users;

use App\Core\Database;
use PDO;

class User
{
    private $conn;
    private $table_name = "users";

    public function __construct()
    {
        $this->conn = Database::getInstance(DB_HOST, DB_NAME, DB_USER, DB_PASS)->getConnection();
    }

    public function getAllUsers()
    {
        $query = "SELECT id, name, email FROM " . $this->table_name;
        $stmt = $this->conn->prepare($query);
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }

    public function getUserById($id)
    {
        $query = "SELECT id, name, email FROM " . $this->table_name . " WHERE id = :id LIMIT 0,1";
        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(':id', $id);
        $stmt->execute();
        return $stmt->fetch(PDO::FETCH_ASSOC);
    }

    public function createUser($data)
    {
        $query = "INSERT INTO " . $this->table_name . " (name, email, password) VALUES (:name, :email, :password)";
        $stmt = $this->conn->prepare($query);

        $name = htmlspecialchars(strip_tags($data['name']));
        $email = htmlspecialchars(strip_tags($data['email']));
        $password = password_hash($data['password'], PASSWORD_BCRYPT); // Mã hóa mật khẩu

        $stmt->bindParam(':name', $name);
        $stmt->bindParam(':email', $email);
        $stmt->bindParam(':password', $password);

        if ($stmt->execute()) {
            return true;
        }
        return false;
    }

    public function updateUser($id, $data)
    {
        $query = "UPDATE " . $this->table_name . " SET name = :name, email = :email WHERE id = :id";
        $stmt = $this->conn->prepare($query);

        $name = htmlspecialchars(strip_tags($data['name']));
        $email = htmlspecialchars(strip_tags($data['email']));

        $stmt->bindParam(':name', $name);
        $stmt->bindParam(':email', $email);
        $stmt->bindParam(':id', $id);

        if ($stmt->execute()) {
            return true;
        }
        return false;
    }

    public function deleteUser($id)
    {
        $query = "DELETE FROM " . $this->table_name . " WHERE id = :id";
        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(':id', $id);

        if ($stmt->execute()) {
            return true;
        }
        return false;
    }
}
Vanilla JS SPA Code Thuần (Frontend: Admin Dashboard)
Frontend sẽ là một ứng dụng Single-Page Application (SPA) hoàn toàn được xây dựng bằng Vanilla JavaScript, HTML và CSS, tương tác với backend thông qua các API JSON.

Cấu trúc thư mục cơ bản
/public             // (Cùng thư mục với backend's public)
    /css
        style.css
    /js
        main.js             // Logic chính của SPA (Router, API calls, Component rendering)
        api.js              // Các hàm gọi API
        router.js           // Logic định tuyến frontend
        components          // Các thành phần UI (UserList, UserForm, ProductList, etc.)
            UserList.js
            UserForm.js
            ProductList.js
        pages               // Các trang (Dashboard, UsersPage, ProductsPage)
            DashboardPage.js
            UsersPage.js
            ProductsPage.js
    index.html          // File HTML chính của SPA
Các thành phần chính
public/index.html: Trang HTML chính, nơi SPA sẽ được render.

HTML

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>Admin Dashboard</h1>
            <nav>
                <a href="/" data-link>Dashboard</a>
                <a href="/users" data-link>Users</a>
                <a href="/products" data-link>Products</a>
            </nav>
        </header>
        <main id="content"></main>
    </div>

    <script type="module" src="/js/main.js"></script>
</body>
</html>
public/js/router.js: Xử lý định tuyến phía frontend.

JavaScript

// public/js/router.js
export class Router {
    constructor(routes) {
        this.routes = routes;
        window.addEventListener('popstate', () => this.handleRouting());
        document.addEventListener('DOMContentLoaded', () => {
            document.body.addEventListener('click', e => {
                if (e.target.matches('[data-link]')) {
                    e.preventDefault();
                    this.navigateTo(e.target.href);
                }
            });
            this.handleRouting();
        });
    }

    navigateTo(url) {
        history.pushState(null, null, url);
        this.handleRouting();
    }

    async handleRouting() {
        const path = window.location.pathname;
        const route = this.routes.find(r => {
            // Đơn giản hóa khớp route, có thể phức tạp hơn với regex cho tham số
            const routePath = r.path.replace(/\{[a-zA-Z0-9_]+\}/g, '([a-zA-Z0-9_]+)');
            const regex = new RegExp(`^<span class="math-inline">\{routePath\}</span>`);
            return regex.test(path);
        });

        if (route) {
            const match = path.match(new RegExp(`^<span class="math-inline">\{route\.path\.replace\(/\\\{\[a\-zA\-Z0\-9\_\]\+\\\}/g, '\(\[a\-zA\-Z0\-9\_\]\+\)'\)\}</span>`));
            const params = match ? match.slice(1) : []; // Lấy các tham số nếu có
            const view = new route.view(); // Tạo instance của Page
            document.getElementById('content').innerHTML = await view.getHtml(params);
            view.attachEvents(); // Gắn các sự kiện sau khi render
        } else {
            document.getElementById('content').innerHTML = `<h1>404 Not Found</h1><p>The page you requested could not be found.</p>`;
        }
    }
}
public/js/api.js: Chứa các hàm gọi API đến backend.

JavaScript

// public/js/api.js
const API_BASE_URL = '/api'; // Đường dẫn base cho API

async function request(url, method = 'GET', data = null) {
    const options = {
        method,
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
        },
    };

    if (data) {
        options.body = JSON.stringify(data);
    }

    try {
        const response = await fetch(`<span class="math-inline">\{API\_BASE\_URL\}</span>{url}`, options);
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Something went wrong');
        }
        return await response.json();
    } catch (error) {
        console.error('API Error:', error);
        throw error;
    }
}

export const UsersAPI = {
    getAll: () => request('/users'),
    getById: (id) => request(`/users/${id}`),
    create: (data) => request('/users', 'POST', data),
    update: (id, data) => request(`/users/${id}`, 'PUT', data),
    delete: (id) => request(`/users/${id}`, 'DELETE'),
};

export const ProductsAPI = {
    getAll: () => request('/products'),
    // ...
};
public/js/components/UserList.js: Một component để hiển thị danh sách người dùng.

JavaScript

// public/js/components/UserList.js
import { UsersAPI } from '../api.js';

export class UserList {
    constructor() {
        this.users = [];
    }

    async fetchUsers() {
        try {
            this.users = await UsersAPI.getAll();
        } catch (error) {
            console.error('Error fetching users:', error);
            this.users = []; // Xử lý lỗi, có thể hiển thị thông báo
        }
    }

    async getHtml() {
        await this.fetchUsers();
        if (this.users.length === 0) {
            return `<p>No users found.</p>`;
        }
        return `
            <h2>Users List</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${this.users.map(user => `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>
                                <button class="edit-user" data-id="${user.id}">Edit</button>
                                <button class="delete-user" data-id="${user.id}">Delete</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
            <button id="add-new-user">Add New User</button>
        `;
    }

    attachEvents() {
        // Gắn sự kiện cho các nút Edit/Delete
        document.querySelectorAll('.edit-user').forEach(button => {
            button.addEventListener('click', (e) => {
                const userId = e.target.dataset.id;
                // Chuyển hướng đến trang chỉnh sửa người dùng
                history.pushState(null, null, `/users/edit/${userId}`);
                window.dispatchEvent(new Event('popstate')); // Kích hoạt lại router
            });
        });

        document.querySelectorAll('.delete-user').forEach(button => {
            button.addEventListener('click', async (e) => {
                const userId = e.target.dataset.id;
                if (confirm(`Are you sure you want to delete user ${userId}?`)) {
                    try {
                        await UsersAPI.delete(userId);
                        alert('User deleted successfully!');
                        // Refresh danh sách
                        history.pushState(null, null, '/users');
                        window.dispatchEvent(new Event('popstate'));
                    } catch (error) {
                        alert('Failed to delete user: ' + error.message);
                    }
                }
            });
        });

        const addNewButton = document.getElementById('add-new-user');
        if (addNewButton) {
            addNewButton.addEventListener('click', () => {
                history.pushState(null, null, '/users/new');
                window.dispatchEvent(new Event('popstate'));
            });
        }
    }
}
public/js/pages/UsersPage.js: Trang quản lý người dùng, sử dụng UserList.

JavaScript

// public/js/pages/UsersPage.js
import { UserList } from '../components/UserList.js';
import { UserForm } from '../components/UserForm.js'; // Sẽ tạo sau

export class UsersPage {
    constructor() {
        this.userList = new UserList();
        this.userForm = new UserForm();
    }

    async getHtml(params = []) {
        const action = params[0]; // Có thể là 'edit' hoặc 'new'
        const userId = params[1]; // ID người dùng nếu là 'edit'

        let contentHtml = '';
        if (action === 'new') {
            contentHtml = await this.userForm.getHtml('new');
        } else if (action === 'edit' && userId) {
            contentHtml = await this.userForm.getHtml('edit', userId);
        } else {
            contentHtml = await this.userList.getHtml();
        }
        return `
            <div class="users-page">
                <h1>Manage Users</h1>
                ${contentHtml}
            </div>
        `;
    }

    attachEvents() {
        // Tùy thuộc vào nội dung hiển thị (list hay form), gắn sự kiện tương ứng
        const path = window.location.pathname;
        if (path.includes('/users/new') || path.includes('/users/edit')) {
            this.userForm.attachEvents();
        } else {
            this.userList.attachEvents();
        }
    }
}
public/js/main.js: File khởi tạo SPA và định nghĩa các route.

JavaScript

// public/js/main.js
import { Router } from './router.js';
import { DashboardPage } from './pages/DashboardPage.js'; // Sẽ tạo sau
import { UsersPage } from './pages/UsersPage.js';
import { ProductsPage } from './pages/ProductsPage.js'; // Sẽ tạo sau

const routes = [
    { path: '/', view: DashboardPage },
    { path: '/users', view: UsersPage },
    { path: '/users/new', view: UsersPage },
    { path: '/users/edit/{id}', view: UsersPage }, // Route với tham số
    { path: '/products', view: ProductsPage },
    // Thêm các route khác
];

const router = new Router(routes);
Tổng kết và lời khuyên
Hiểu luồng dữ liệu: SPA gửi request (GET/POST/PUT/DELETE) đến API backend. Backend (PHP Controller) xử lý request, tương tác với Model (Database), và trả về JSON. Frontend (Vanilla JS) nhận JSON, cập nhật DOM để hiển thị dữ liệu mà không cần tải lại trang.
Quản lý trạng thái (State Management): Với Vanilla JS, quản lý trạng thái có thể phức tạp hơn so với các framework như React/Vue. Bạn cần tự thiết kế cách các component chia sẻ và cập nhật dữ liệu. Các pattern như Event Bus hoặc Global State Object có thể hữu ích.
Authentication & Authorization:
Backend: Sử dụng JWT (JSON Web Tokens) hoặc Session-based authentication. Khi người dùng đăng nhập, backend trả về một token.
Frontend: Lưu trữ token (trong localStorage hoặc sessionStorage). Gửi token này trong header Authorization: Bearer <token> của mỗi request đến API cần bảo vệ. Backend sẽ xác thực token trước khi xử lý request.
Xử lý lỗi (Error Handling): Cả backend và frontend cần có cơ chế xử lý lỗi mạnh mẽ để thông báo cho người dùng khi có sự cố.
CSS: Sử dụng CSS thuần hoặc các thư viện CSS (như Bootstrap/Tailwind CSS) để thiết kế giao diện.
Ưu điểm của code thuần: Giúp bạn hiểu sâu sắc về kiến trúc, cách hoạt động của HTTP, AJAX, và cách các thành phần tương tác.
Nhược điểm của code thuần: Phát triển chậm hơn, dễ mắc lỗi hơn, khó mở rộng và bảo trì hơn so với việc sử dụng framework khi dự án lớn.
Bắt đầu với những ví dụ nhỏ, đơn giản từng bước, sau đó mở rộng dần các tính năng. Khi bạn đã nắm vững kiến thức cơ bản này, việc chuyển sang các framework như Laravel/React/Vue sẽ dễ dàng hơn rất nhiều vì bạn đã hiểu được nguyên lý hoạt động cốt lõi của chúng.
# v2
Được rồi, để viết lại đoạn code Vanilla JS SPA của bạn sử dụng script type="module", chúng ta cần thực hiện một số thay đổi nhỏ để tận dụng tính năng module của JavaScript. Điều này giúp code của bạn rõ ràng hơn và dễ quản lý hơn trong các dự án lớn hơn.

Các bước thay đổi:

Tạo một tệp module chính (ví dụ: main.js): Thay vì tất cả code trong app.js, chúng ta sẽ tách các phần logic ra thành các module riêng biệt và nhập chúng vào một tệp chính.
Sử dụng export: Để các hàm có thể được sử dụng ở các tệp module khác, chúng ta cần export chúng.
Sử dụng import: Trong tệp module chính, chúng ta sẽ import các hàm đã được export từ các module khác.
Cập nhật index.html: Thay đổi thuộc tính src của thẻ <script> thành tệp module chính mới và thêm type="module".
Cấu trúc dự án mới (ví dụ):

your-spa-project/
├── index.html
├── style.css
└── js/
    ├── main.js         <-- Tệp module chính
    ├── views/
    │   ├── home.js
    │   ├── about.js
    │   ├── contact.js
    │   └── notFound.js
    └── router.js
1. Cập nhật index.html
Chúng ta sẽ thay đổi thẻ <script> để tải main.js dưới dạng module.

HTML

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vanilla JS SPA Module</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <a href="#home">Trang chủ</a> |
        <a href="#about">Giới thiệu</a> |
        <a href="#contact">Liên hệ</a>
    </nav>

    <div id="app">
        Đang tải nội dung...
    </div>

    <script type="module" src="./js/main.js"></script>
</body>
</html>
2. Tạo các tệp module (js/)
js/views/home.js
JavaScript

// js/views/home.js
export function getHomePageContent() {
    return `
        <h1>Chào mừng bạn đến với SPA của tôi!</h1>
        <p>Đây là trang chủ. Bạn có thể điều hướng đến các trang khác bằng cách nhấp vào các liên kết ở trên.</p>
        <p>Ứng dụng này chỉ sử dụng Vanilla JavaScript ở phía frontend.</p>
    `;
}
js/views/about.js
JavaScript

// js/views/about.js
export function getAboutPageContent() {
    return `
        <h1>Giới thiệu</h1>
        <p>Đây là một ví dụ đơn giản về ứng dụng một trang (SPA) được xây dựng hoàn toàn bằng HTML, CSS và JavaScript.</p>
        <p>Mục đích là để minh họa cách định tuyến và hiển thị nội dung mà không cần tải lại trang.</p>
    `;
}
js/views/contact.js
JavaScript

// js/views/contact.js
export function getContactPageContent() {
    return `
        <h1>Liên hệ</h1>
        <p>Nếu bạn có bất kỳ câu hỏi nào, vui lòng liên hệ:</p>
        <ul>
            <li>Email: example@example.com</li>
            <li>Điện thoại: 123-456-7890</li>
        </ul>
    `;
}
js/views/notFound.js
JavaScript

// js/views/notFound.js
export function getNotFoundPageContent() {
    return `
        <h1>404 - Không tìm thấy trang</h1>
        <p>Trang bạn đang tìm kiếm không tồn tại.</p>
        <p>Vui lòng kiểm tra lại URL hoặc quay lại <a href="#home">Trang chủ</a>.</p>
    `;
}
js/router.js
Đây là module chứa logic định tuyến chính.

JavaScript

// js/router.js

// Import các hàm lấy nội dung trang từ các module views
import { getHomePageContent } from './views/home.js';
import { getAboutPageContent } from './views/about.js';
import { getContactPageContent } from './views/contact.js';
import { getNotFoundPageContent } from './views/notFound.js';

// Hàm helper để in ra console (nếu cần cho debugging)
function tt(t) {
    console.log(t);
}

// Hàm xử lý định tuyến chính
export function handleRouting(appElement) { // Nhận appElement làm đối số
    const hash = window.location.hash.substring(1);
    tt(hash); // Debugging

    let content = '';

    switch (hash) {
        case 'home':
        case '': // Nếu không có hash hoặc hash rỗng, mặc định là trang chủ
            content = getHomePageContent();
            break;
        case 'about':
            content = getAboutPageContent();
            break;
        case 'contact':
            content = getContactPageContent();
            break;
        default: // Nếu hash không khớp với bất kỳ trang nào
            content = getNotFoundPageContent();
            break;
    }

    // Cập nhật nội dung của phần tử 'app'
    appElement.innerHTML = content;
}
js/main.js (Tệp module chính)
Đây là điểm vào của ứng dụng. Nó sẽ import handleRouting và thiết lập các sự kiện.

JavaScript

// js/main.js

import { handleRouting } from './router.js';

// Lấy tham chiếu đến phần tử chứa nội dung SPA
const app = document.getElementById('app');

// Lắng nghe sự kiện thay đổi hash
window.addEventListener('hashchange', () => handleRouting(app));

// Gọi hàm handleRouting một lần khi tải trang ban đầu
// Truyền app element vào hàm handleRouting
handleRouting(app);
Giải thích về script type="module":
Hệ thống Module gốc (Native ES Modules): Với type="module", trình duyệt hiểu rằng tệp JavaScript này là một module ES6. Điều này cho phép bạn sử dụng cú pháp import và export trực tiếp trong trình duyệt mà không cần các công cụ bundling như Webpack hay Rollup (đối với các dự án nhỏ).
Chế độ nghiêm ngặt ('use strict'): Code trong module tự động chạy ở chế độ nghiêm ngặt, giúp bạn viết code an toàn hơn.
Phạm vi biến (Scope): Các biến và hàm được khai báo ở cấp cao nhất trong một module sẽ có phạm vi module (chứ không phải toàn cục như script thông thường), ngăn ngừa xung đột tên. Bạn phải export rõ ràng những gì muốn chia sẻ.
Hoãn thực thi (Deferred by default): Các script module được thực thi sau khi HTML đã được phân tích cú pháp hoàn toàn (tương tự như thuộc tính defer), đảm bảo rằng các phần tử DOM đã sẵn sàng khi script của bạn chạy. Điều này có nghĩa là bạn có thể đặt <script type="module" src="..."></script> trong <head> mà không cần defer hay lắng nghe DOMContentLoaded.
Module chỉ được thực thi một lần: Nếu một module được import nhiều lần, nó chỉ được thực thi một lần duy nhất.
Với cách tiếp cận này, code của bạn được tổ chức tốt hơn, dễ đọc, dễ bảo trì và mở rộng hơn trong tương lai.